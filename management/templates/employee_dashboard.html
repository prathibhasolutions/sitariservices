{% extends "masteremployee.html" %}
{% load static %}


{% block content %}
<main class="col-md-9 ml-sm-auto col-lg-10 px-4 py-4">
    <h2>Welcome, {{ employee.name }}!</h2>
    <div class="card mt-3">
        <div class="card-body">
            <h5 class="card-title mb-4">Your Profile</h5>
            <div class="table-responsive">
                <table class="table table-bordered table-striped mb-0">
                    <tbody>
                        <tr>
                            <th scope="row">Employee Name</th>
                            <td>{{ employee.name }}</td>
                        </tr>
                        <tr>
                            <th scope="row">Mobile Number</th>
                            <td>{{ employee.mobile_number }}</td>
                        </tr>
                        <tr>
                            <th scope="row">Department</th>
                            <td>
                                {% if employee.department %}
                                    {{ employee.department.name }}
                                {% else %}
                                    <span class="text-muted">Not set</span>
                                {% endif %}
                            </td>
                        </tr>

                        <!-- Working Hours Row -->
                        <tr>
                            <th scope="row">Working Hours</th>
                            <td>
                                {% if employee.working_start_time and employee.working_end_time %}
                                    {{ employee.working_start_time|time:"H:i" }} - {{ employee.working_end_time|time:"H:i" }}
                                {% else %}
                                    <span class="text-muted">Not set</span>
                                {% endif %}
                            </td>
                        </tr>

                        <tr>
                            <th scope="row">Salary</th>
                            <td>
                                {% if show_sensitive %}
                                    ₹{{ employee.salary }}
                                {% else %}
                                    {% if otp_sent and not otp_verified %}
                                        <form method="post" class="form-inline">
                                            {% csrf_token %}
                                            <input type="text" name="otp" class="form-control form-control-sm mr-2" placeholder="Enter OTP" required>
                                            <button type="submit" name="verify_otp" class="btn btn-sm btn-primary">Verify OTP</button>
                                        </form>
                                    {% else %}
                                        <form method="post" class="form-inline">
                                            {% csrf_token %}
                                            <button type="submit" name="send_otp" class="btn btn-sm btn-primary">Unlock with OTP</button>
                                        </form>
                                    {% endif %}
                                {% endif %}
                            </td>
                        </tr>

                        <!-- Commission Row -->
                        <tr>
                            <th scope="row">Commission (Current Month)</th>
                            <td>
                                {% if show_sensitive %}
                                    ₹{{ current_month_commission|default:"0.00" }}
                                {% else %}
                                    <span class="text-muted">Locked</span>
                                {% endif %}
                            </td>
                        </tr>

                        <tr>
                            <th scope="row">PF</th>
                            <td>
                                {% if show_sensitive %}
                                    {% if employee.pf %}
                                        ₹{{ employee.pf }}
                                    {% else %}
                                        <span class="text-muted">Not set</span>
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">Locked</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">ESI</th>
                            <td>
                                {% if show_sensitive %}
                                    {% if employee.esi %}
                                        ₹{{ employee.esi }}
                                    {% else %}
                                        <span class="text-muted">Not set</span>
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">Locked</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">Joining Date</th>
                            <td>{{ employee.joining_date }}</td>
                        </tr>
                    </tbody>
                </table>
                {% if messages %}
                    <div class="mt-3">
                        {% for message in messages %}
                            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</main>
<script src="{% static 'js/auto_logout.js' %}"></script>

{% endblock %}
