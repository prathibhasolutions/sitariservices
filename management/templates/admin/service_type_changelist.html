{% extends "admin/change_list.html" %}
{% load static %}

{# This block places the button right above the results table #}
{% block result_list %}
<div class="d-flex justify-content-end mb-2">
  <a href="#" id="print-button" class="btn btn-primary">Print Table</a>
</div>
{{ block.super }} {# This renders the actual table #}
{% endblock %}


{# The final JavaScript with CSS overrides goes here #}
{% block extrahead %}
{{ block.super }}
<script>
document.addEventListener('DOMContentLoaded', (event) => {
    const printBtn = document.getElementById('print-button');
    if (printBtn) {
        printBtn.addEventListener('click', (e) => {
            e.preventDefault();
            
            // 1. Clone the results table
            const table = document.getElementById('result_list').cloneNode(true);

            // 2. Remove the first cell (checkbox column) from each row
            const rows = table.querySelectorAll('tr');
            rows.forEach(row => {
                // Remove the action checkbox cell
                if (row.cells.length > 0) {
                    row.deleteCell(0);
                }
            });

            // 3. Add Bootstrap table classes for styling
            table.classList.add('table', 'table-bordered');

            // 4. Create a new window for printing
            const printWindow = window.open('', '', 'height=600,width=900');
            
            printWindow.document.write('<html><head><title>Service Types</title>');
            // 5. Inject Bootstrap CSS from a CDN
            printWindow.document.write('<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">');

            // 6. **NEW:** Add custom CSS to override link and header colors
            printWindow.document.write(`
                <style>
                    /* Set a base color for the print body */
                    body {
                        color: #000;
                    }
                    /* Override the blue color on table headers (th) and links (a) */
                    th, .action-checkbox-column a, #result_list a {
                        color: #000 !important; /* Force color to black */
                        text-decoration: none !important; /* Remove underline from links */
                    }
                    /* Ensure all table data is normal weight unless specified */
                    td {
                        font-weight: normal;
                    }
                    /* Make the first data column bold */
                    td:first-child {
                        font-weight: bold;
                    }
                </style>
            `);

            printWindow.document.write('</head><body class="p-4">'); // Add padding
            printWindow.document.write('<h1 class="mb-4">Service Types</h1>'); // Add a styled title
            printWindow.document.body.appendChild(table);
            printWindow.document.write('</body></html>');
            
            printWindow.document.close();
            
            setTimeout(() => {
                printWindow.focus();
                printWindow.print();
                printWindow.close();
            }, 250);
        });
    }
});
</script>
{% endblock %}
